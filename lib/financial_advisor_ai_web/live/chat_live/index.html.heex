<div class="flex h-screen bg-gray-100">
  <!-- Sidebar -->
  <div class="w-64 bg-white shadow-md">
    <div class="p-4">
      <button
        phx-click="new_conversation"
        class="w-full bg-blue-500 text-white rounded-lg px-4 py-2 hover:bg-blue-600"
      >
        New Conversation
      </button>
    </div>

    <div class="overflow-y-auto">
      <%= for conversation <- @conversations do %>
        <div
          phx-click="select_conversation"
          phx-value-id={conversation.id}
          class={"p-4 cursor-pointer hover:bg-gray-100 #{if @current_conversation && @current_conversation.id == conversation.id, do: "bg-gray-200"}"}
        >
          <div class="font-medium">{conversation.title}</div>
          <div class="text-sm text-gray-500">
            {Calendar.strftime(conversation.inserted_at, "%b %d, %Y")}
          </div>
        </div>
      <% end %>
    </div>
  </div>
  
<!-- Chat Area -->
  <div class="flex-1 flex flex-col">
    <%= if @current_conversation do %>
      <!-- Messages -->
      <div class="flex-1 overflow-y-auto p-6">
        <div class="max-w-3xl mx-auto">
          <%= for message <- @messages do %>
            <div class={"mb-6 #{if message.role == "user", do: "text-right"}"}>
              <div class={"inline-block p-4 rounded-lg #{if message.role == "user", do: "bg-blue-500 text-white", else: "bg-white"}"}>
                <div class="whitespace-pre-wrap">{message.content}</div>

                <%= if message.tool_calls do %>
                  <div class="mt-2 text-sm opacity-75">
                    ðŸ”§ Using tools...
                  </div>
                <% end %>
              </div>

              <div class="text-xs text-gray-500 mt-1">
                {Calendar.strftime(message.inserted_at, "%I:%M %p")}
              </div>
            </div>
          <% end %>

          <%= if @processing do %>
            <div class="text-center">
              <div class="inline-flex items-center px-4 py-2 bg-gray-200 rounded-lg">
                <svg
                  class="animate-spin h-4 w-4 mr-2"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle
                    class="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    stroke-width="4"
                  >
                  </circle>
                  <path
                    class="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  >
                  </path>
                </svg>
                Processing...
              </div>
            </div>
          <% end %>
        </div>
      </div>
      <!-- value={@message_input}
              phx-keyup="update_message" -->
<!-- Input Area -->
      <div class="border-t bg-white p-4">
        <div class="max-w-3xl mx-auto">
          <form phx-submit="send_message" class="flex gap-4">
            <input
              type="text"
              name="message[content]"
              placeholder="Type your message..."
              class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              disabled={@processing}
            />
            <button
              type="submit"
              class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50"
              disabled={@processing}
            >
              Send
            </button>
          </form>
        </div>
      </div>
    <% else %>
      <div class="flex-1 flex items-center justify-center text-gray-500">
        Select a conversation or create a new one
      </div>
    <% end %>
  </div>
</div>
